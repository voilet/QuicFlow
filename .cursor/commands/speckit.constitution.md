---
description: 根据交互式或提供的原则输入创建或更新项目宪章，确保所有相关模板保持同步
---

## 📋 命令用途

**定义项目的核心原则和开发规范**

---

## 用户输入

```text
$ARGUMENTS
```

在继续之前，您**必须**考虑用户输入（如果不为空）。

## 执行流程

您正在更新位于 `.specify/memory/constitution.md` 的项目宪章。这是一个包含方括号占位符（例如 `[PROJECT_NAME]`、`[PRINCIPLE_1_NAME]`）的模板文件。您的任务是：(a) 收集/推导具体值，(b) 精确填充模板，(c) 将修改传播到相关文件。

请按以下执行流程操作：

1. 加载位于 `.specify/memory/constitution.md` 的现有宪章模板
   - 识别所有形如 `[ALL_CAPS_IDENTIFIER]` 的占位符
   **重要**：用户可能需要比模板中更多或更少的原则。如果指定了数量，请遵循通用模板结构并相应更新文档

2. 收集/推导占位符的具体值：
   - 如果用户输入（对话）提供了值，使用它
   - 否则从现有仓库上下文推断（README、文档、之前嵌入的宪章版本）
   - 对于治理日期：`RATIFICATION_DATE` 是原始批准日期（如果未知则询问或标记 TODO），`LAST_AMENDED_DATE` 是修改时的今天日期，否则保留之前的值
   - `CONSTITUTION_VERSION` 必须遵循语义化版本规则递增：
     * MAJOR（主版本）：向后不兼容的治理/原则删除或重新定义
     * MINOR（次版本）：新增原则/章节或实质性扩展的指导
     * PATCH（补丁）：澄清、措辞、错别字修正、非语义改进
   - 如果版本升级类型不明确，在最终确定前提出理由

3. 起草更新后的宪章内容：
   - 用具体文本替换每个占位符（不留括号标记，除非项目有意保留的模板槽位—需明确说明理由）
   - 保留标题层级，替换后可以删除注释，除非它们仍能提供澄清指导
   - 确保每个原则章节包含：简洁的名称行、段落（或项目列表）描述不可协商的规则、明确的理由（如果不明显）
   - 确保治理章节列出修订程序、版本控制策略和合规审查期望

4. 一致性传播检查清单（将先前清单转换为主动验证）：
   - 读取 `.specify/templates/plan-template.md` 并确保任何"宪章检查"或规则与更新后的原则一致
   - 读取 `.specify/templates/spec-template.md` 进行范围/需求对齐—如果宪章添加/删除了必填章节或约束则更新
   - 读取 `.specify/templates/tasks-template.md` 并确保任务分类反映新增或删除的原则驱动任务类型（例如可观测性、版本控制、测试纪律）
   - 读取 `.specify/templates/commands/*.md` 中的每个命令文件（包括本文件），验证不再有过时的引用（如仅针对 CLAUDE 的代理特定名称），当需要通用指导时
   - 读取任何运行时指导文档（例如 `README.md`、`docs/quickstart.md` 或代理特定的指导文件）。更新对已更改原则的引用

5. 生成同步影响报告（更新后作为 HTML 注释添加到宪章文件顶部）：
   - 版本变更：旧版本 → 新版本
   - 已修改原则列表（如果重命名则为：旧标题 → 新标题）
   - 新增章节
   - 删除章节
   - 需要更新的模板（✅ 已更新 / ⚠ 待处理）及文件路径
   - 如果有故意推迟的占位符，记录后续待办事项

6. 最终输出前的验证：
   - 无剩余未解释的括号标记
   - 版本行与报告匹配
   - 日期采用 ISO 格式 YYYY-MM-DD
   - 原则是声明性的、可测试的，不含模糊语言（"should" → 在适当时替换为 MUST/SHOULD 并说明理由）

7. 将完成的宪章写回 `.specify/memory/constitution.md`（覆盖）

8. 向用户输出最终摘要，包含：
   - 新版本和升级理由
   - 任何标记为需要手动跟进的文件
   - 建议的提交消息（例如：`docs: amend constitution to vX.Y.Z (principle additions + governance update)`）

格式和样式要求：
- 完全按照模板中的 Markdown 标题使用（不降级/升级标题级别）
- 长理由行要换行以保持可读性（理想情况下 <100 字符），但不要强制执行以避免不自然的断行
- 章节间保持一个空行
- 避免尾随空格

如果用户提供部分更新（例如仅修订一个原则），仍需执行验证和版本决策步骤。

如果关键信息缺失（例如批准日期确实未知），插入 `TODO(<FIELD_NAME>): explanation` 并在同步影响报告的推迟项目中记录。

不要创建新模板；始终操作现有的 `.specify/memory/constitution.md` 文件。
