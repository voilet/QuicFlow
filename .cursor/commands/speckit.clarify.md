---
description: 通过提出最多 5 个高度针对性的澄清问题来识别当前功能规范中未充分说明的领域，并将答案编码回规范
---

## 📋 命令用途

**解决规范中的模糊和歧义问题**

---

## 用户输入

```text
$ARGUMENTS
```

在继续之前，您**必须**考虑用户输入（如果不为空）。

## 执行流程

目标：检测并减少活动功能规范中的歧义或缺失决策点，并将澄清直接记录在规范文件中。

注意：此澄清工作流预期在调用 `/speckit.plan` 之前运行（并完成）。如果用户明确声明他们跳过澄清（例如探索性尝试），您可以继续，但必须警告下游返工风险会增加。

执行步骤：

1. 从仓库根目录**一次性**运行 `.specify/scripts/bash/check-prerequisites.sh --json --paths-only`（组合 `--json --paths-only` 模式 / `-Json -PathsOnly`）。解析最小 JSON 负载字段：
   - `FEATURE_DIR`
   - `FEATURE_SPEC`
   - （可选捕获 `IMPL_PLAN`、`TASKS` 用于未来链式流程。）
   - 如果 JSON 解析失败，中止并指示用户重新运行 `/speckit.specify` 或验证功能分支环境。
   - 对于参数中的单引号（如"I'm Groot"），使用转义语法：例如 'I'\''m Groot'（或者如果可能使用双引号："I'm Groot"）。

2. 加载当前规范文件。使用此分类法执行结构化的歧义和覆盖率扫描。对于每个类别，标记状态：清晰 / 部分 / 缺失。生成用于优先排序的内部覆盖率映射（除非不会提出问题，否则不输出原始映射）。

   功能范围和行为：
   - 核心用户目标和成功标准
   - 明确的范围外声明
   - 用户角色/人物角色区分

   领域和数据模型：
   - 实体、属性、关系
   - 身份和唯一性规则
   - 生命周期/状态转换
   - 数据量/规模假设

   交互和用户体验流程：
   - 关键用户旅程/序列
   - 错误/空/加载状态
   - 可访问性或本地化说明

   非功能质量属性：
   - 性能（延迟、吞吐量目标）
   - 可扩展性（水平/垂直、限制）
   - 可靠性和可用性（正常运行时间、恢复期望）
   - 可观测性（日志记录、指标、跟踪信号）
   - 安全和隐私（身份验证、授权、加密、数据保留、合规性）

   集成和依赖关系：
   - 外部系统、API、服务依赖
   - 向后兼容性或迁移路径
   - 环境/部署约束

3. 从覆盖率映射中，选择最多 5 个具有最高影响/风险的澄清问题。优先级：
   - 范围歧义（例如多个解释）
   - 缺失的关键决策（例如身份验证方法、数据保留）
   - 性能/安全性差距
   - 用户体验细节中的漏洞

4. 对于每个选定的问题（最多 5 个），向用户提出一个结构化问题，使用此格式：

   ```markdown
   ## 澄清问题 [N]：[主题]
   
   **规范引用**：[引用相关章节或需求]
   
   **需要澄清的内容**：[具体问题]
   
   **建议选项**：
   
   | 选项 | 答案 | 影响 |
   |------|------|------|
   | A    | [第一个建议答案] | [这对功能意味着什么] |
   | B    | [第二个建议答案] | [这对功能意味着什么] |
   | C    | [第三个建议答案] | [这对功能意味着什么] |
   | 自定义 | 提供您自己的答案 | [解释如何提供自定义输入] |
   
   **您的选择**：_[等待用户回复]_
   ```

5. 等待用户响应所有问题（例如："Q1: A, Q2: 自定义 - [详情], Q3: B"）。

6. 对于每个答案：
   - 将澄清内容编码回规范文件的适当章节
   - 删除任何 `[需要澄清]` 标记（如果存在）
   - 在假设条件章节记录决策理由（如果相关）

7. 更新质量检查清单（`FEATURE_DIR/checklists/requirements.md`），将"没有遗留的 [需要澄清] 标记"标记为通过。

8. 向用户报告澄清摘要：
   - 已解决的问题数量
   - 更新的规范章节
   - 下一步建议（通常是 `/speckit.plan`）

## 关键规则

- 最多 5 个问题 - 保持重点和可操作性
- 问题必须具体且有针对性，而不是开放式的
- 提供建议答案以加快决策
- 直接更新规范文件，不要创建单独的文档
- 如果没有重大歧义，通知用户规范已经清晰，可以直接进行 `/speckit.plan`
